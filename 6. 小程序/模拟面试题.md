# 模拟面试题

## 十一、小程序

### 5.1 微信小程序和 H5 应用的区别

第一，微信小程序的双线程
两者之间最大的区别应该在于底层模型。传统的 H5 页面里，js 引擎线程和 GUI 渲染线程是互斥的。而在微信小程序里，逻辑层线程和渲染层线程是并行，二者之间通过客户端进行中转通信。

第二，为什么提出双线程

1. 为了快。微信小程序使用双线程模型的目的是就是快，并行的双线程避免了 H5 应用里的线程互斥造成渲染阻塞，所以可以拥有更好的渲染性能。
2. 为了管控和安全。传统的 web 技术，可以进行跳页面、操作DOM 之类的，但这些在小程序里都是不允许的，为什么呢，就是为了管控和安全。因为小程序里有一些组件比如 open-data，只负责展示用户的数据，但不能被 js 拿到，因为有一些数据属于用户隐私。但如果可以进行 DOM 操作的话，这些数据是肯定可以拿到的。所以微信小程序通过客户端自带的 js 引擎去创建了一个 js 线程，这个 js 线程只负责纯 js 代码的解析执行。

第三，双线程的缺点
因为是逻辑层和渲染层并行，二者之间还通过客户端进行中转通信，所以肯定会存在延时问题。也就是说，逻辑层已经把数据给修改了，但是渲染层可能还没有开始渲染。

因此我们可以发现，小程序的大部分 API 都是设计成异步的。

### 5.2 微信登录

1. 小程序调用 wx.login() 请求临时 code，将 code 发送给开发者后台
2. 开发者后台用 code、appid、appSecret 向微信服务端请求用户的 opendid，然后将 openid 和业务 id 联系起来，返回对应的用户信息/登录token 给小程序
3. 小程序最后就可以拿到用户信息或登录 token

### 5.3 原生组件

微信内置组件里，存在一些组件是使用客户端进行渲染的，这部分组件叫原生组件。原生组件的原理是，在 DOM 里面插入一个占位元素，然后在占位元素上用一个原生界面去渲染内容。这个原生界面的层级比其他的 DOM 节点都要高。

原生组件的优点：

1. 渲染性能更好，因为使用了客户端渲染。
2. 时延更低，因为原生组件在逻辑层里有 context 上下文对象，通过 context 对数据进行修改后，通过客户端中转后直接传入组件。

原生组件的缺点：

1. 因为使用客户端渲染，一些 css 样式是失效的
2. 原生组件的层级比全部 DOM 原生都要高