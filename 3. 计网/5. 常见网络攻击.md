# XSS和CSRF攻击

### 一、XSS 跨站点脚本

xss 攻击，通过给网页注入 js 代码，代码执行后会对网页进行攻击，比如盗取 cookie、sessionStorage 等。

>  所以用来维持登录状态的 cookie 一般会开启 http-only ，进而避免 xss 攻击用 document.cookie 访问到。 

#### 1、反射型XSS

一般是诱导用户点击某个链接，而攻击脚本会直接放在请求 url 上，最后又返回给页面，这个过程类似反射，所以叫反射型 XSS，也叫非持久型 XSS。

#### 2、存储型XSS

存储型 XSS，一般是通过页面的输入框去注入 js 脚本代码到后端的数据库，然后页面下次再拉取数据时，会直接拉取到 \<script\> 脚本，然后直接解析执行。

它比反射型 xss 危害更大，因为它是将攻击代码存储到数据库，而数据库里的数据可能是全部用户都能请求的，也就是说可能对全部用户产生危害。

#### 3、DOM型XSS

前端页面使用了 innerHTML、outerHTML 进行 DOM 插入时，不会对 script 标签进行转义，所以一旦通过这些 api 插入的模板字符被注入 script 脚本，就会产生攻击。 

#### 4、如何解决xss注入问题：
xss 攻击的攻击目的很多，我们可以对不同目的的攻击进行预防。比如，xss 攻击可能会通过 js 盗取你的 cookie，那么提前把保留登录态的 cookie 设为 http-only，避免可以通过 js 通过 document.cookie 进行访问。

另外，还有一种常见的预防操作就是，对 scrpit 标签进行转义。无论是前端还是后台，对于一些可能要插入到页面的字符串都进行转义，避免被插入 scrpit 脚本而去执行。

### 二、CSRF 跨站点请求伪造
CSRF 攻击，是欺骗用户浏览器，让其以用户的名义运行操作。

用户登录一个网站 A，然后退出，但是没有关闭浏览器，这时，登录态 cookie 还保留在浏览器里。
然后，用户去浏览第三方网站，第三方网站可以利用网站 A 的 cookie 来伪造用户身份，向网站 A 的服务器发送恶意请求。

预防 CSRF 攻击，有很多方法，下面列举两个：
1. 请求源检测：http 的请求头有一个请求源字段，服务端通过判断请求源来拦截请求。但，如果第三方网站和原网站是同源的，或者伪造头部字段，就没办法了。
2. 添加校验 token：token 是前端网页所持有的，而不是浏览器所持有的，所以 CSRF 是无法利用token ，也就是无法伪造身份。
