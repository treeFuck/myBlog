# 计算机网络
## 一、概述
### 1.1 互联网
互联网：网络把主机连接起来，而互连网（internet）是把多种不同的网络连接起来，因此互连网是网络的网络。而互联网（Internet）是全球范围的互连网。
ISP：互联网提供商，可以从互联网管理机构获取许多 IP 地址，同时拥有通信线路已经路由器等联网设备，个人或机构向 ISP 缴纳一定的费用就可以接入互联网。
### 1.2 主机之间的通信方式
1. 客户端-服务端（C/S）→ 客户端发起请求，服务端响应请求来提供服务
2. 对等（P2P）→ 不区分客户端和服务端
### 1.3 电路交换和分组交换
#### 电路交换
比如电话通信系统，两个用户在通信前需要建立一条专业的物理链路，并且在整个通信过程一直占用该链路。

因为通信过程不可能一直传输数据，所以电路交换对线路的利用率很低，往往不到 10%

#### 分组交换
以分组为单位，使用存储转发机制实现数据交换的通信方式。

分组交换不需要占用传输路线，多个分组在同一个传输路线上互不影响，所以对线路的利用率会比电路交换高得多。

### 1.4 时延
总时延 = 排队时延 + 处理时延 + 传输时延 + 传播时延
#### 排队时延
分组在路由器的输入队列和输出队列中排队等待的时间，取决于网络当前的通信量。
#### 处理时延
主机或路由器收到分组时，对分组进行处理所需要的时间。例如分组首部、从首部提取数据等。
#### 传输时延
主机或路由器传输数据帧所需要的时间。
#### 传播时延
电磁波在信道中传播所需要的时间。

### 1.5 计算机网络体系结构
分为三类：五层协议体系，OSI 体系，TCP/IP 体系。其中，五层协议是比较主流的体系结构。

#### 五层协议
- **应用层**：为**特定的应用程序**提供数据传输服务，例如 HTTP、DNS 等协议。**数据单位为报文**。
- **传输层**：为**进程**提供通用数据传输服务。运输层包括两种协议：TCP 和 UDP。**TCP** 提供**面向连接**、可靠的数据传输服务，**数据单位是报文段**；**UDP** 提供**无连接**、尽最大努力的数据传输服务，数据单位是**用户数据报**。
- **网络层**：为**主机**提供数据传输服务。传输层是为主机中的进程提供数据传输服务，网络层是把传输层传递下来的报文段或用户数据报封装成**分组**。
- **数据链路层**：网络层针对的是还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为**同一链路的主机**提供数据传输服务。数据链路把网络层传下来的分组封装成**帧**。
- **物理层**：考虑的是怎样在**传输媒体**上传输**数据比特流**，而不是指具体的传输媒体。物理层的作业是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。

> 数据在各层之间传递时，向下传递，需要添加下层协议所需首部或尾部；向上传递，需要不断拆开首部或尾部。
> 
> **路由器只有下面三层协议**，因为路由器位于网络核心中，**不需要为进程或应用程序提供服务**，因此也就不需要传输层和应用层。

## 二、物理层
**物理层**：考虑的是怎样在**传输媒体**上传输**数据比特流**，而不是指具体的传输媒体。物理层的作业是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。
### 1. 通信方式
- 单工通信：单向传输
- 半双工通信：双向交替传输
- 全双工通信：双向同时传输
### 2. 带通调制
模拟信号是连续的信号，数字信号是离散的信号。带通调制把数字信号转换为模拟信号。

## 三、链路层
**数据链路层**：网络层针对的是还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为**同一链路的主机**提供数据传输服务。数据链路把网络层传下来的分组封装成**帧**。
### 1. MAC 地址
MAC 地址是链路层地址，长度为 6 个字节（48位），用于唯一标识网络适配器（网卡）。

一台主机拥有多少网络适配器就有多少个 MAC 地址。例如笔记本电脑普遍存在无线网络适配器和有线网络适配器，因此就有两个 MAC 地址。

只要不更改自己的MAC地址，MAC地址在世界是唯一的。形象地说，MAC地址就如同身份证上的身份证号码，具有唯一性 。

### 2. 局域网
局域网是一种典型的广播信道，主要特定是网络为一个单位所拥有，且地理范围和站点数目均有限制。目前以以太网占领着有线局域网市场。

### 3. 以太网
以太网是一种星型拓扑结构局域网。

以太网早期用集线器进行连接，集线器是一种物理层设备，同时收到两个不同接口的帧时会发生碰撞。

目前以太网使用交换机替代了集线器，交换机是一种链路层设备，它不会发生碰撞，能根据 MAC 地址进行存储转发。

### 4. 交换机
交换机是一种链路层设备，能根据 MAC 地址进行存储转发。

交换机具有自学习能力，学习的是交换表的内容，交换表中存储着 MAC 地址到接口的映射。

### 5. 虚拟局域网
虚拟局域网可以建立与物理位置无关的逻辑组，只有在同一个虚拟局域网中的成员才会收到链路层广播信息。

## 四、网络层
**网络层**：为**主机**提供数据传输服务。传输层是为主机中的进程提供数据传输服务，网络层是把传输层传递下来的报文段或用户数据报封装成**分组**。

### 1. 概述
网络层是整个互联网的核心。网络层向上指提供简单灵活的、无连接的、尽最大努力交换的数据报服务。

使用 IP 协议，可以把异构的物理网络连接起来，使得在网络层看起来好像是一个统一的网络。

与 IP 协议配套使用的还有三个协议：
1. 地址解析协议 ARP
2. 网际控制报文协议 ICMP
3. 网际组管理协议 IGMP

### 2. IP 地址编址
IP 地址编址经历三个历史阶段：
1. 分类
2. 子网划分
3. 无分类

### 3. 地址解析协议 ARP
网络层实现主机之间的通信，而链路层实现具体每段链路之间的通信。因此在通信过程中，IP 数据报的源地址和目的地址始终不变，而 MAC 地址随着链路的改变而改变。

ARP 实现由 IP 地址得到 MAC 地址。

### 4. 网际控制报文协议 ICMP
ICMP 是为了更有效地转发 IP  数据报和提高交付成功的机会。它封装在 IP 数据报里，单不属于高层协议。

Ping 就是 ICMP 的一个重要应用，主要用啦测试两台主机之间的连通性。

Ping 的原理是通过向目的主机发生 ICMP Echo 请求报文，目的主机收到后会发送 Echo 回答报文。Ping 会根据时间和成功响应的次数估算出数据包往返时间以及丢包率。

## 五、传输层
**传输层**：为**进程**提供通用数据传输服务。运输层包括两种协议：TCP 和 UDP。**TCP** 提供**面向连接**、可靠的数据传输服务，**数据单位是报文段**；**UDP** 提供**无连接**、尽最大努力的数据传输服务，数据单位是**用户数据报**。

### 1. 三次握手

### 2. 四次挥手

## 六、应用层
**应用层**：为**特定的应用程序**提供数据传输服务，例如 HTTP、DNS 等协议。**数据单位为报文**。

### 1. 常用协议
- DNS 协议 → 域名解析 → 传输层使用 UDP/TCP 协议
- FTP 协议 → 文件传送协议 → 传输层使用 TCP 协议
- HTTP 协议 → 超文本传送协议 → 传输层使用 TCP 协议

