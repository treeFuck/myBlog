# HTTP

## 一、概述
### 1.1 与 HTTP 协议密不可分的几个协议
1. IP 协议 → 网络层，主机之间的通信
2. ARP 协议 → 在网络层通信靠 IP 地址，在链路层传递数据靠 MAC 地址，ARP 协议可以根据 IP 协议分查出对应的 MAC 地址
3. TCP 协议 → 传输层，主机间的程序进程之间的通信 
4. DNS 协议 → 解析域名，查找 IP 地址

### 1.2 Cookie
HTTP/1.1 是无状态协议，即协议本身不保留之前一切的请求和响应报文信息。

为了实现期待的保持状态功能，引入了 Cookie 技术。

客户端发起请求，服务端会在响应报文里放一个 Set-Cookie 首部字段信息，通知客户端保存 Cookie。当下次客户端再请求时，会自动在请求报文中加入 Cookie 值后才发送出去。

### 1.3 客户端 HTTP 方法
1. GET → 获取资源
2. POST → 传输实体主体
3. PUT → 传输文件
4. DELETE → 删除文件
5. HEAD → 获得报文首部
6. OPTIONS → 询问服务端支持的方法
7. TRACE → 追踪路径
8. CONNECT → 要求用隧道协议连接代理

### 1.4 响应报文状态码
- 1xx → 请求正在处理
- 2xx → 成功
- 3xx → 重定向
- 4xx → 客户端错误
- 5xx → 服务端错误

## 二、HTTP 首部

### 2.1 HTTP 报文结构
看一下请求报文和响应报文的结构：
<img src="./HTTP报文结构.jfif" style="zoom: 67%;" />

再来看两个实例：
<img src="./HTTP报文实例.jfif" style="zoom: 67%;" />

### 2.2 首部字段
HTTP/1.1规范定义了如下47种首部字段，下面简要介绍几种常见的：

#### 1. 请求首部字段
- Host：请求资源所处的互联网主机号和端口号（请求报文首部里唯一一个必须字段）
- Referer：发起请求的原始资源 URI
- Authorization：用户代理的认证信息
- User-Agent：用户代理的信息，如名称等
- Accpet：用户代理可处理的媒体类型，如 text/html
- Accept-Charset：用户代理支持的字符集，如 iso-8859-5
- Accept-Encoding：用户代理支持的内容编码，如 gzip
- Accept-Language：用户代理可处理的自然语言集，如 zh-cn(中文)

#### 2. 响应首部字段
- Server：HTTP 服务端的安装信息
- Location：另客户端重定向至指定 URI

#### 3. 通用首部字段
- Date：报文创建日期和时间
- Cache-Control：该字段用于操作缓存的工作机制
- Transfer-Encoding：规定传输报文主体时，采用的编码方式
- Connection：控制某个首部字段不再被代理服务器转发 / 管理持久连接

#### 4. 实体首部字段
> 通常，报文主体等于实体主体。

- Allow：通知客户端，支持请求该资源的所有 HTTP 方法
- Expires：通知客户端，资源失效日期
- Last-Modified：通知客户端，资源最终的修改时间
- Content-Encoding：通知客户端，实体主体的编码方式
- Content-Language：通知客户端，实体主体使用的自然语言
- Content-Length：通知客户端，主体实体的大小（单位是字节）
- Content-Type：通知客户端，主体实体的媒体类型

#### 5. 为 Cookie 服务的首部
> 这部分不在 HTTP/1.1规范定义的 47 种首部字段里

- Set-Cookie：响应式首部字段，里面包含服务器告知客户端的 Cookie 信息
- Cookie：请求首部字段，客户端发给服务器的 Cookie 

## 三、HTTP/2.0 和 HTTP/1.1 的比较
### 1. 多个请求共享同一个 TCP 连接
- HTTP/1.1 多个请求共享一个 TCP 连接时，是串行共享，即前面请求没结束，后面的不会开始
- HTTP2 是采用并行策略，实现多路复用，而且不同的 HTTP 请求会有优先级别
### 2. 数据流格式
- HTTP/1.1 的数据流是文本流
- HTTP/2.0 采用二进制分帧形式，消息有一个帧或多个帧组成，服务器解析起来更快速
### 3. 是否支持服务器主动推送
- HTTP/1.1 不支持
- HTTP/2.0 支持
### 4. 首部压缩
- HTTP/1.1 的首部带有大量信息，而且每次都要重复发送
- HTTP/2.0 在客户端和服务器之间维护一个包含之前见过的首部字段表，每次请求只会发送更新的首部字段，另外还使用 Huffman 编码对首部字段进行压缩