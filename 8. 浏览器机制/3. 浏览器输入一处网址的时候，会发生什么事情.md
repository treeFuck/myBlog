# 浏览器输入一处网址的时候，会发生什么事情

1. 如果 URL 里使用的是域名，那么会用 DNS 协议解析域名得到 IP 地址
	1. 在浏览器缓存查询 DNS 缓存记录
	2. 如果浏览器缓存没有，则去操作系统里查找 DNS 缓存记录
	3. 如果操作系统缓存也没有，则向本地域名服务器发起查询请求，一般是递归查询
	4. 如果本地域名服务器上的缓存也找不到，则让本地域名服务器向根域名服务器发起请求，一般是迭代查询
	5. 查询顺序：根域名服务器 → 顶级域名服务器 → 二级域名服务器 → 三级服务器……
2. TCP 三次握手建立连接
	1. 第一次握手，客户端发送 SYN=1，ACK=0 的报文，请求连接
	2. 第二次握手，服务端返回 SYN=1，ACK=1 的报文，同意连接
	3. 第三次握手，客户端发送 ACK=1 的报文，给服务端一个确认（第三次握手的目的是，为了防止失效的连接请求发送到服务端而产生错误）
3. 发送 HTTP 请求，这是一个 `GET` 请求
4. 后台处理前端请求，返回响应报文，响应报文主体里包含着请求的网页 HTML
5. TCP 四次挥手断开连接
	1. 第一次挥手，客户端发送 FIN=1 的报文，请求断开连接
	2. 第二次挥手，服务端返回一个确认报文，表示它收到请求了，但是还没准备好
	3. 第三次挥手，服务端发送一个 FIN=1 的报文，表示服务端准备好断开连接
	4. 第四次挥手，客户端发送一个确认报文，服务端收到确认报文后断开连接，而客户端等待 2MSL 后断开连接
6. 浏览器拿到 HTML，解析渲染
	1. 解析 HTML，生成 DOM 树
	2. 解析 CSS，生成 CSS 规则树
	3. 结合 DOM 树和 CSS 规则树，构建 render 树
	4. 布局 layout：计算各元素位置、大小
	5. 绘制 paint：绘制页面

浏览器内核的 GUI 渲染线程和 JS 引擎线程是互斥的。所以，如果在解析 HTML 时遇到 script 标签，GUI 渲染进程会将执行权交出给 JS 引擎线程，让 JS 引擎线程去解析和执行 script 标签里的 js 代码。

之所以这样设计，是因为：如果两个线程可以并行，那么会出现这边 js 线程在修改 DOM，而另一边渲染线程在渲染页面，最后可能导致渲染的结果和 DOM 不符，或者是其他的一些冲突错误。



 