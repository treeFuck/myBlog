# 总

## 一、vi/vim

模式与模式切换：
1. 命令模式：刚启动 vi/vim，进入命令模式
2. 输入模式：在命令模式下，输入 `i`，进入输入模式
3. 底线命令模式：在输入模式下，输入 `:`，进入底线输入模式

命令模式 / 底线命令模式下，常用命令：
1. `i` → 进入输入模式
2. `:q` → 退出程序
3. `:w` → 保存文件
4. `:wq` → 保存文件并退出程序
5. ESC → 退出底线输入模式


## 二、shell 脚本的执行方式
shell 脚本执行时，会根据第一行指明的执行环境去寻找环境变量 ENV，加载到环境变量文件后，就可以执行脚本里的代码了。

shell 脚本执行方式：
1. `bash a.sh` 或 `sh a.sh`:  指明环境来执行该脚本，所以脚本开头可以不指名运行环境
2. `a.sh`: 脚本拥有可执行权限时，可以直接使用脚本路径位置来执行该脚本
3. `source a.sh` 或 `. a.sh`：用这种方法去执行子脚本，可以将子脚本的变量值或函数返回值传递回当前父脚本

## 三、shell 变量
```bash
test='QG'  # 定义变量，=两边不能留空格  
echo $test
```

### 3.1 定义字符串，三种方式
1. 无引号：变量会被解析
2. 单引号：变量不会被解析 → 适合定义纯字符串
3. 双引号：变量会被解析 → 适合定义模板字符串

### 3.2 获取命令运行结果，并赋值给变量，两种方式
1. ``变量= `node -v` ``:  不推荐，因为会和单引号搞混
2. `变量=$(node -v)`:  推荐使用

### 3.3 特殊变量
1. `$0` → 脚本文件名
2. `$n` → 脚本的第 n 个参数
3. `$?` → 上一个指令的执行状态返回值（0 成功，非 0 失败）
4. `$$` → 该脚本的进程 id

### 3.4 bash 内置命令
1. `echo`: 输出
	+ `echo -n` → 不换行输出
	+ `echo -e` → 解析转义字符输出，比如下面这些：
		+ `\n` → 换行
		+ `\r` → 回车
		+ `\t` → 制表符（Tab）
		+ `\b` → 退格
		+ `\v` → 纵向制表符
2. `exec`：不去创建新的子进程，而是在本进程执行其他指令，指令执行完毕后，本进程也会被终结（所以一般要放到脚本末尾来执行）
3. `read a b c`：读取用户输入流，赋值到变量 a、b、c
4. `exit 0`：退出该脚本进程，后面可以接退出状态码
5.  `expr length "tstasasasaa"`：用以表达式计算、字符串长度计算等

## 四、数值计算

在 bash 的数值计算符号里，幂运算是 `**`。

### 4.1 数值计算并赋值给变量，有 3 种方法
1. `a=$((1+1*99))`
2. `let a=‘1+1*99’`
3. ``a=`expr 1 + 1` ``：expr 是一个指令，所以需要包在反引号里作为命令去执行，然后将运行结果赋值给变量 a。另外， expr 后的运算字符与字符直接必须留空

## 五、条件测试

条件测试语法，有四种：
1. `test <表达式>`：test 语句
	+ `test -f a.js` → 判断文件 a.js 是否存在，存在为 true
	+ `test -z “tttt”` → 判断字符串 “tttt” 长度是否为 0，0 为 true
2. `[ -f a.js ]`: 和 test 等价，不过要注意括号内部左右要留空
3. `[[  ]]`

### 5.1 文件测试（以下都是为 true 的情况）
1. `[ -f a.js ]`：文件 a.js 存在且为普通文件
2. `[ -d ./aa ]`：目录 ./aa 存在
3. `[ -e aaaa ]`：文件/目录 aaaa 存在
4. `[ -r a.js ]`：文件 a.js 可读
5. `[ -w a.js ]`：文件 a.js 可写
6. `[ -s a.js ]`：文件 a.js 存在且大小不为 0 
7. `[ a.js -nt b.js]`：a.js 比 b.js 新（比较两者的最后修改时间）
8. `[ b.js -nt a.js]`：a.js 比 b.js 旧（比较两者的最后修改时间）

### 5.2 字符串测试操作符
1. `[ -n "aaa" ]`：字符串长度不为 0
2. `[ -z "aaa" ]`：字符串长度为 0
3. `[ "$s1" == "$s2" ]`：字符串 s1、s2 相等（== 两端记得留空）
4. `[ "$s1" != "$s2"  ]`：字符串 s1、s2 不相等（!= 两端记得留空）

### 5.3 整数二元比较操作符

| [ ] 和 test | [[ ]] 和 (( )) |           说明            |     示例      |
| :---------: | :------------: | :-----------------------: | :-----------: |
|     -eq     |     == / =     |       相等（equal）       | `[ 1 -eq 1 ]` |
|     -ne     |       !=       |    不相等（not equal）    | `[ 1 -ne 2 ]` |
|     -gt     |       >        |   大于（greater than）    | `[ 2 -gt 1 ]` |
|     -ge     |       >=       | 大于等于（greater equal） |      ...      |
|     -lt     |       <        |     小于（less than）     |      ...      |
|     -le     |       <=       |  小于等于（less equal）   |      ...      |

### 5.4 逻辑操作符

| [ ] 和 test | [[ ]] 和 (( )) | 说明 |              示例               |
| :---------: | :------------: | :--: | :-----------------------------: |
|     -a      |       &&       | and  | `[ -f "$file1" -a -f "$fil2" ]` |
|     -o      |      \|\|      |  or  |               ...               |
|      !      |       !        | not  |               ...               |

### 5.5 总结
- 记不住可以通过 `man test` 查看 test 支持的命令
- 建议使用 `[ ]` 和 `if(( ))`
- 条件测试的返回值是无法 echo 打印的，如果想要测试一个表达式的真假，可以这样：
	+ `[ 表达式 ] && echo 1 || echo 0`
	+ 上述指令中，表达式为 true 则 echo 1，为 false 则 echo 0

## 六、if 语句
```bash
# 条件表达式可以是 test、[]、[[]]、(())
if <条件表达式1>
	then
		指令
elif <条件表达式2>
	then
		指令
else
		指令
fi
```

## 七、shell 函数
```bash
# 定义函数
function fun() {
	read -p "输入一个数字:" a
	echo "$a + 2 = $(($a+$1))"
	return 1
}

# 执行函数
fun 1
```

## 八、case 条件语句
```bash
case "变量" in
	值1)
		指令1...
		;;
	值2)
		指令2...
		;;
	*) # 都不符合的时候，跑到这里
		指令3...
esac	
```

## 九、while 循环语句
```bash
# while
while <条件表达式>
do
	指令...
done

# until → 条件表达式不成立时进入循环，成立时跳出循环
until <条件表达式>
do
	指令...
done
```

## 十、for 语句
```bash
# 第一种 for 循环 → 变量取值型
for num in 5 4 3 2 100
do
	echo $num
done

# 第二种 for 循环 → C 语音类型 for 循环
for ((i=1; i < 3; i++))
do
	echo $i
done
```

## 十一、break、continue、exit、return 的比较
1. `break n`：如果省略 n，则表示跳出整个循环。n 表示跳出循环的层数。
2. `continue n`：如果省略 n，则表示跳过本次循环，忽略本次循环的剩余代码，进入循环的下一次循环。n 表示退出到第 n 层继续循环。
3. `exit n`：退出当前 shell 程序，n 为上一次程序执行的状态返回值。n 也可以省略，在下一个 shell 里可通过 “$?” 接收 exit n 的 n 值。
4. `return n`：用于在函数里作为函数的返回值，以判断函数执行是否正确。在下一个 shell 里可通过 "$?" 接收 return n 的 n 值。

## 十二、shell 数组
### 12.1 定义
```bash
arr=(1 2 3 4 5)

arr=([1]=aaa [2]=bbb [3]=ccc)

arr[0]=aaa; arr[1]=bbb; arr[2]=ccc;
```

### 12.2 使用
```bash
echo ${arr[0]} # 打印一个

echo ${arr[*]} # 打印全部

echo ${#arr[*]} # 打印长度
```

### 12.3 赋值与删除
```bash
arr[7]=99 # 给数组里下标为 7 的元素重新赋值，如果该元素不存在，则添加新元素进去

unset arr[7] # 移除数组里下标为 7 的元素
```

### 12.4 数组内容的截取和替换
```bash
echo ${array[*]:1:4} # 截取数组下标从 1 到 4 的元素 

echo ${array[*]/1/b} # 把数组中的 1 替换成 b，原数组不变
```

### 12.5 遍历数组
```bash
arr=(1 2 3 4 5)
for((i=0; i<${#arr[*]}; i++)) 
	do
		echo ${arr[i]}
	done
```

## 十三、子 shell 和 shell 嵌套
















