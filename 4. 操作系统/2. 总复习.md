# 操作系统
## 一、概述
操作系统四大基本特征：**并发，共享，虚拟，异步**。
### 1. 并发
并发：在**宏观**上同一时间段里执行多个任务，但**同一时刻只能执行一个任务**。
并行：**同一时刻可以同时执行多个任务**。

举个例子，对于多核CPU来说，进程只能并发执行，但进程的多线程是并行执行的。

### 2. 共享
操作系统的资源被多个并发进程共同使用。有两种共享方式：**互斥共享，同时共享**。

互斥共享：必须等上一个进程用完了，下一个进程才能去使用，比如打印机。这类资源也叫临界资源。

同时共享：并发进程在宏观上可以 “同时” 访问同一个资源，比如磁盘存储设备。

### 3. 虚拟
>  1B = 1Byte = 1子节 = 8bit = 8 位

两种虚拟技术：**时分复用技术，空分复用技术**。

多个进程能在同一个处理器上并发执行使用了时分复用技术，让每个进程轮流占用处理器，每次只执行一小个时间片并快速切换。

**虚拟内存**使用了空分复用技术，它将物理内存抽象为地址空间，每个进程都有各自的地址空间。地址空间的页被映射到物理内存，地址空间的页并不需要全部在物理内存中，当使用到一个没有在物理内存的页时，执行页面置换算法，将该页置换到物理内存中。

### 4. 异步
异步，是指进程不是一次性执行完毕，而是走走停停，以不可知的速度向前推进。

比如进程 A 想使用打印机资源，但打印机这时被进程 B 使用，所以进程 A 必须等待进程 B 使用完打印机后才能使用打印机继续进程执行。

## 二、进程管理
### 1. 进程与线程
**进程：程序的一次执行，分配资源的基本单位。**
**线程：独立调度的基本单位，一个进程可以有多个线程，它们共享进程资源。**

进程和线程的区别：
1. **拥有资源**：进程是资源分配的基本单位，线程不拥有资源，但线程可以访问其隶属进程的资源。
2. **调度**：线程的是独立调度的基本单位。在同一进程中，线程的切换不会引起进程切换，从一个进程中的线程切换到另一个进程中的线程时，会引起进程切换。
3. **系统开销**：创建、撤销、切换进程的开销的远远大于创建、撤销、切换线程的开销。
4. **通信**：线程可以通过直接读写同一进程的数据进行通信，但进程通信需要借助 IPC。

### 2. 进程状态的切换
进程有三种状态：
1. **就绪 ready** → 等待被调度
2. **运行 running** → 运行
3. **阻塞 waiting** → 等待资源

状态转换：
1. **就绪和运行可以相互转换** → 就绪的进程通过调度算法分配到时间片就会运行；而运行的进程用完时间片就回到就绪。（**运行 → 就绪 → 运行 → 就绪 → 运行**）
2. 阻塞：运行的进程缺少除时间片外的资源（比如打印机资源）后就被阻塞，等到分配到缺少资源后就回到就绪状态。（**运行 → 阻塞 → 就绪 → 运行**）
### 3. 进程调度算法
不同环境下调度目的不同，使用的调度算法也不同。

**批处理系统：没有太多用户操作 → 调度目的是保证吞吐量和周转时间**
1. 先来先去服务（FCFS）→ 不利于短作业
2. 短作业优先（SJF）→ 不利于长作业
3. 最短剩余时间优先（SRTN）

**交互式系统：有大量用户操作 → 调度目的是快速地响应**
1. 时间片轮转 → 将就绪进程排成队列，不断给队首分配时间片，队首执行完时间片后被移到队尾。
2. 优先级调度 → 给进程分配优先级，按优先级进行调度。
3. 多级反馈队列 → 设计多级队列，每级队列时间片不同，优先级按时间片从小到大排序。进程在第一个队列没执行完就移入下一个队列。（可以看出前两种算法的集合）

### 4. 进程同步
进程同步：多个进程因为合作产生的直接制约关系，使得进程有一定的先后执行关系。

进程同步处理机制：
1. **互斥锁机制**：多个进程在同一时刻只有一个进程可以访问临界资源，一个在使用，其他必须等待。
2. **信号量机制**：通过信号来控制访问同一资源的进程数量。一个进程使用该资源，信号量-1，当信号量为 0 时，资源不能再被新进程访问。等到一个进程用完该资源，信号量+1，可以让新进程访问资源。

## 三、死锁
略

## 四、内存管理
### 1. 虚拟内存
虚拟内存使用了**空分复用技术**，它将物理内存抽象为更大的地址空间，从而使程序获得更多的可用内存。

每个进程都有各自的地址空间，这个地址空间被分割成多个块，每一块称为一页，地址空间的页被映射到物理内存。

地址空间的页并不需要全部在物理内存中，当使用到一个没有在物理内存的页时，执行**页面置换算法**，将该页置换到物理内存中。

### 2. 页面置换算法
页面置换算法的目的是使得页面置换频率最低 (也可以说缺页率最低)，主要有以下六种页面置换算法：
1. 最久未使用（也叫最佳）
2. 最近未使用
3. 最近最久未使用 
4. 先进先出
5. 第二机会算法
6. 时钟

## 五、设备管理
### 1. 磁盘
磁盘：计算机主要的存储介质，可以存储大量的二进制数据，并且断电后也能保持数据不丢失。
磁盘结构：
1. 盘面：一个磁盘有多个盘面。
2. 磁道：盘面上的圆形带状区域，一个盘面有多个磁道。
3. 扇区：磁道上的一个弧段，一个磁道有多个扇区，**最小的物理存储单位**。

### 2. 磁盘调度算法
读写磁盘时间的影响因素：
1. 旋转时间 → 寻找合适扇区
2. 寻道时间 → 寻找合适的磁道
3. 实际的数据传输时间

其中，**寻道时间最长**，因此磁盘调度的主要目标是使磁盘的平均寻道时间最短。

有三种调度算法：
1. 先来先去服务 → 按照磁盘请求顺序进行调度
2. 最短寻道时间优先 → 优先调度与当前磁头所在磁道最近的磁道 → 两端磁道容易饥饿
3. 电梯算法（扫描算法） → 先按一个方向进行磁盘调度，直到该方向没有未完成的磁盘请求，然后改变方向 