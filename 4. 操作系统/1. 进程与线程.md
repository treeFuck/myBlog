# 进程与线程
### 1. 前景知识
- 并发：一会处理这个任务，一会又处理那个任务，但是**同一时刻只处理一个任务**。
- 并行：可以**同时处理多个任务**。
- 进程：程序的一次执行，资源分配的基本单位。**任何时刻，CPU总是运行一个进程**，其他进程处于非运行状态。所以**单个CPU只能并发处理多个进程**。
- 线程：一个进程可以包括多个线程，多个线程共享该进程分配到的资源。**单核CPU的线程处理是并发，多核CPU的线程处理是并行。**
### 2. 模拟理解
#### 假设我是CPU
假设**我是CPU**，我闭上眼睛，**操作系统调度器将一个进程分配给我**之后，我拿到进程睁开眼，我看到的是什么？

我看到的是进程中的很多线程，所以**我能调度的只能是线程**。

如果我是四核的CPU，我就能把线程ABCD分配到核心1234**并行**执行，如果我是单核的CPU，我只能不断切换线程让他们**并发**执行。
#### 假设CPU是一个工厂
1. 假设CPU是一个工厂，时刻在运行。
2. 工厂电力有限，一次只能供给一个车间使用，其他车间必须停工。进程就像车间，任一时刻CPU只能运行一个进程，其他进程处于非运行状态。
3. 一个车间里，有很多工人，他们**协同完成一个任务**。线程好比车间里的工人，一个进程可以包括多个线程。
4. 同一个车间里，所有的房间都是全部工人共享使用的。这就像一个进程的内存空间是全部线程共享使用的。
5. 但是房间有大小，有些房间最多容纳一个人，比如厕所，得一个一个来轮流使用。这就比如一个线程使用进程里共享内存的时候，其他线程必须等待。
6. 那工人上厕所的时候，怎么防止别人突然闯入呢？（狗头保命）有一个办法就是进去之后把厕所门锁上。这就是**进程的“互斥锁”**，防止多个线程同时读写某一个内存。
7. 还有些房间，可以同时多个人进入，比如厨房可以容纳3个人，那么就可以在门口挂3把钥匙，进去的时候把钥匙带走，走的时候把钥匙放回，外面的人看到钥匙空了就在门口排队等着。这种做法叫做**“信号量”**。
### 3. 总结
- 单CPU计算机中进程只能并发，多CPU计算机中进程可以并行
- 单核CPU中线程只能并发，多核CPU中线程可以并行
- 无论是并发还是并行，在用户眼里，都是计算机在同时处理多个任务
> 参考文献：
> [阮一峰——进程与线程的一个简单解释](http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)
> [高坦的博客——多CPU/多核/多进程/多线程/并发/并行之间的关系
](https://www.cnblogs.com/gtscool/p/13072051.html)