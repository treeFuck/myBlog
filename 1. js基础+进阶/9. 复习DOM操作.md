# 复习 DOM 
> **前言：DOM** (Document Object Model) 是 js 操作网页的接口，它的本质是将网页抽象成 js 对象，进而可以通过 js 操作来对网页进行各种操作。
>
> 在解析 html 生成 DOM 的时候，html 会被解析成一系列的节点对象（node），再由这些节点拼接成一个树状结构。
>
> 所以 **DOM 的基本组成单位就是 node** 节点，node 节点一共有 **12 种类型**。

## 一、节点类型
### 1.1 节点类型概述
node 一共有 12 种类型，统一的是它们都至少拥有这三种属性：
1. **nodeType**：1-12 的数值，对应 12 种类型
2. **nodeName**：节点的名称
3. **nodeValue**：节点的值

初略看一下 nodeType 对应的节点类型：
```js
元素节点            　　Node.ELEMENT_NODE(1)
属性节点            　　Node.ATTRIBUTE_NODE(2)
文本节点            　　Node.TEXT_NODE(3)
CDATA节点             Node.CDATA_SECTION_NODE(4)
实体引用名称节点    　　 Node.ENTRY_REFERENCE_NODE(5)
实体名称节点        　　Node.ENTITY_NODE(6)
处理指令节点        　　Node.PROCESSING_INSTRUCTION_NODE(7)
注释节点            　 Node.COMMENT_NODE(8)
文档节点            　 Node.DOCUMENT_NODE(9)
文档类型节点        　　Node.DOCUMENT_TYPE_NODE(10)
文档片段节点        　　Node.DOCUMENT_FRAGMENT_NODE(11)
DTD声明节点            Node.NOTATION_NODE(12)
```
### 1.2 元素节点
```js
{
	nodeType: 1,
	nodeName: 标签名,
	nodeValue: null,
	
	attributes: 属性集合,
	classList: 类名集合,
	
	parentNode: 父节点，
	parentElement: 父元素节点，
	
	childNodes: 子节点集合，
	children: 子元素节点，
	firstChild: 第一个子节点，
	lastChild: 最后一个子节点,
	firstElementChild: 第一个元素子节点，
	lastElementChild: 最后一个元素子节点，
	
	nextSibling: 后一个节点，
	previousSibling: 前一个节点，
	nextElementSibling: 后一个元素节点，
	previousElementSibling: 前一个元素节点
}
```
相关 api 太多，放后面具体介绍。

### 1.3 属性节点
```js
{
	nodeType: 2
	nodeName: 属性名
	nodeValue: 属性值
}
```
api 简要：
1. document.createAttribute(name)：创建一个名为 name 的属性节点
2. 其他 api 很少用，略

### 1.4 文本节点
```js
{
	nodeType: 3,
	nodeName: '#text',
	nodeValue: 标签文本内容,
	data: 标签文本内容，
	length：文本长度，
}
```
api 简要：
1. createTextNode：创建文本节点并返回
2. normalize：在元素节点调用，合并相邻的文本子节点
3. splitText：在文本子节点调用，将一个文本节点分割成两个
4. appendData：在文本节点调用，将文本添加到节点末尾
5. deleteData：在文本节点调用，从指定位置删除指定数量的字符
6. insertData：在文本节点调用，在指定位置插入指定的字符
7. replaceData：在文本节点调用，在指定位置替换指定的字符
8. substringData：在文本节点调用，在指定位置提取自动数量的字符

### 1.5 注释节点
```js
{
	nodeType: 8,
	nodeName: '#comment',
	nodeValue: 注释内容,
	data: 注释文本内容，
	length：文本长度，
}
```
api 简要：
1. createComment：创建注释节点并返回
2. 其他 api 与文本节点类似。(注释节点与文本节点继承自相同的基类，所以它拥有除了 splitText() 外所有的字符串操作方法)

注意：所有浏览器都识别不出位于`</html>`后的注释

### 1.6 文档节点
```js
{
	nodeType: 9
	nodeName: '#document'
	nodeValue: null
}
```
文档节点 document，隶属于 window，表示网页页面，又被称为根节点。

> 注意，根节点是 document，不是 html，document.documentElement == html

**快捷访问：**
1. \<html\> :  document.documentElement
2. \<body\>:  document.body
3. \<!DOCTYPE\>:  document.doctype
4. \<head>\:  document.head

**文档信息：**
1. document.title:  文档标题\<title>\
2. document.URL:  页面的完整地址 
3. document.domain:  页面域名
4. document.referrer：链接到当前页面的上一个页面url
5. document.charset：文档字符集
6. document.lastModified：文档最后修改的时间戳

**节点集合：**
1. document.anchors：页面所有带 name 的 \<a\> 标签
2. document.links：页面所有带 href 的 \<a\> 标签
3. document.images：页面所有的 \<img\> 元素
4. document.scripts：页面所有的 \<script>\ 节点

### 1.7 文档类型节点
```js
{
	nodeType: 10,
	nodeName: 文档类型名称,
	nodeValue: null,
	parentNode: Document,
	name: 文档类型名称
}
```
HTML5 的文档类型说明是`<!DOCTYPE html>`。

HTML5 之前，文档类型声明分三类：
1. 严格型 strict
2. 过渡型 transitional
3. 框架 frameset

### 1.8 文档片段节点
```js
{
	nodeType: 11
	nodeName: '#document-fragment'
	nodeValue: null
}
```
DOM 树里面是没有文档片段节点的。文档片段节点是一种“轻量级”文档，可以包含和控制节点，但不会像真实节点一样占用额外资源。

文档片段节点继承了 Node 的所有方法，通常用于执行针对文档的DOM操作。

高频率的 DOM 操作是很消耗渲染性能的，我们可以通过创建一个文档片段节点，在里面进行复杂的 DOM 操作，然后将操作完毕后的 文档片段节点再添加回页面种，这时只会触发浏览器一次渲染，大大减少了渲染消耗。这就是文档片段节点存在的意义。

api 简要：
1. document.createDocumentFragment()：创建并返回文档片段节点
2. 文档片段节点继承了 Node 的所有方法

## 二、获取节点
### 2.1 元素选择器
1. getElementById：根据 id 获取指定元素
2. getElementsByTagName：根据 标签名 获取指定元素集合
3. getElementsByName：根据 name 属性获取指定元素集合
4. getElementsByClassName：根据 class 类名获取指定元素集合
5. querySelector：根据 css 选择符获取匹配元素的第一个
6. querySelectorAll：根据 css 选择符获取匹配元素的全部
7. matchesSelector：判断元素节点与 css 选择符是否匹配

> 注意：getElementsByTagName、getElementsByName、getElementsByClassName 选择到的元素集合是**实时动态**的，而 querySelectorAll 选择到的元素集合都是**非实时动态**的。

### 2.2 动态集合
#### 1. NodeList 类型
- 节点的子节点 node.childNodes：是动态集合
- querySelectorAll 方法返回值：不是动态集合
#### 2. HTMLCollection 类型
**所有的 HTMLCollection 类型都是动态集合**。

HTMLCollection 类型包括 getElementsByTagName()、getElementsByClassName()、getElementsByName() 等方法的返回值，以及 children、document.links、document.forms 等元素集合
#### 3. NamedNodeMap 类型
比如，元素节点的属性集合 node.attributes，是动态集合
#### 4. 注意动态集合造成死循环
```js
var divs = document.getElementsByTagName("div");
for(var i = 0 ; i < divs.length; i++){
    // divs.length 会不断增长
    document.body.appendChild(document.createElement("div"));
}
```

> ps：还有一个更经典的类数组对象——函数内部的 arguments，它也具有动态性

## 三、节点操作
### 3.1 DOM 操作
1. 创建节点：createElement(标签名) 
2. 插入节点：
	2.1 appendChild(node)： 向 childNodes 列表添加一个子节点 node
	2.2 insertBefore(node, a)：向子节点 a 前面插入一个子节点 node，a 为空，则插到末尾
3. 删除节点：
	3.1 removeChild(node)：从 childNodes 里移除子节点 node
	3.2 remove()：从父节点的 childNodes 移除自己
4. 替换节点： replaceChild(newN, oldN)，将 childNodes 里的 oldN 替换为 newN
5. 复制节点：cloneNode(true/false)，复制自身，参数为 true 时深复制，为 false 浅复制

注意，**DOM 插入操作里不存在 insertAfter 方法**，不过这个方法可以借用insertBefore() 和 appendChild() 模拟出来：
```js
function insertAfter(newel, targetel){
    var parent = targetel.parentNode;
    if (parent.lastChild == targetel) {
    	parent.appendChild(newel);
    } else {
    	parent.insertBefore(newel, targetel.nextSibling)
    }
}
```

### 3.2 属性操作
1. hasAttribute(attr)：是否有 attr 这个属性
2. getAttribute(attr)：获取 attr 属性值
3. setAttribute(attr, vl)：设置 attr 属性值为 vl
4. removeAttribute(attr)：移除 attr 属性

### 3.3 类名集合操作
通过元素节点的 classList 属性可以获取到元素节点类名集合，类名集合提供了专有的 api 进行增删查改：
1. classList.add(class1, class2, class3...)：添加一个或多个类名，如果类名已存在则不会添加
2. classList.contains(class)：返回布尔值，判断是否存在某类名
3. remove(class1, class2, class3...)：移除一个或多个类名
4. toggle(class)：切换类名，如果原本拥有类名则删除该类名，如果原本没有该类名则添加该类名（指定第二个参数可以强行添加或移除类）

### 3.4 innerHTML
可读可写，用来替换元素节点全部子节点。不过注意不要使用 “+=” 来追加innerHTML，会造成很大的渲染消耗。

### 3.5 outerHTML
和 innerHTML 类似，不同的是它的读写包括他自己本身。

### 3.6 innerText
可读可写，用来替换元素节点的文本内容。如果元素节点里面有子元素节点，读的时候会深度遍历读取子元素的文本，写的时候会把子元素节点全部删除。

### 3.6 outerText
可读可写。读取的效果与 innerText 完全一致，写的时候会把自己也替换掉。


> 参考博客：https://xiaohuochai.site/JS/DOM/node/nodeOverview.html